---
title: "Analysis.Rmd"
author: "Pirkka"
date: "19.04.2015"
output: html_document
---

## Synopsis



## Data Processing

Load file from web and unzip it:

```{r, cache=TRUE}
if (!file.exists("stormdata.csv.bz2")) {
  download.file(
    "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2", 
    "stormdata.csv.bz2",method="curl")
}

stormdata <- read.csv(bzfile("stormdata.csv.bz2"))
```

The property damage values use a separate column of exponent values. They are translated in to numeric exponents and combined to a single number value.

```{r}
eval_exp <- function(val, exp) {
  switch(as.character(exp), 
         "-"=0, "?"=0, "+"=0, 
         "0"=val, 
         "1"=10*val, 
         "2"=100*val, h=100*val, H=100*val,
         "3"=1000*val, k=1000*val, K=1000*val, 
         "4"=10000*val,
         "5"=100000*val,
         "6"=1000000*val, m=1000000*val, M=1000000*val,
         "7"=10000000*val,
         "8"=100000000*val,
         b=1000000000*val, B=1000000000*val, 0)
}

eval_exp_v <- Vectorize(eval_exp)
```

Create a data frame that sums FATALITIES, INJURIES and PROPDMG:

```{r, cache=TRUE}
stormdata$prop_dmg <- eval_exp_v(stormdata$PROPDMG, stormdata$PROPDMGEXP)

fatalitiesByEventTypeUnOrdered <- aggregate(FATALITIES ~ EVTYPE, stormdata, sum)
fatalitiesByEventType <- fatalitiesByEventTypeUnOrdered[order(fatalitiesByEventTypeUnOrdered$EVTYPE),]

fatalitymeanByEventTypeUnOrdered <- aggregate(FATALITIES ~ EVTYPE, stormdata, mean)
fatalitymeanByEventType <- fatalitymeanByEventTypeUnOrdered[order(fatalitymeanByEventTypeUnOrdered$EVTYPE),]

injuriesByEventTypeUnOrdered <- aggregate(INJURIES ~ EVTYPE, stormdata, sum)
injuriesByEventType <- injuriesByEventTypeUnOrdered[order(injuriesByEventTypeUnOrdered$EVTYPE),]

injuriesmeanByEventTypeUnOrdered <- aggregate(INJURIES ~ EVTYPE, stormdata, mean)
injuriesmeanByEventType <- injuriesmeanByEventTypeUnOrdered[order(injuriesmeanByEventTypeUnOrdered$EVTYPE),]

prop_dmg_mean_eventtype_unordered <- aggregate(prop_dmg ~ EVTYPE, stormdata, mean)
prop_dmg_mean_eventtype <- prop_dmg_mean_eventtype_unordered[order(prop_dmg_mean_eventtype_unordered$EVTYPE),]

prop_dmg_sum_eventtype_unordered <- aggregate(prop_dmg ~ EVTYPE, stormdata, sum)

stormdata_by_event_type <- prop_dmg_sum_eventtype_unordered[order(prop_dmg_sum_eventtype_unordered$EVTYPE),]
stormdata_by_event_type$prop_dmg_mean <- prop_dmg_mean_eventtype$prop_dmg
stormdata_by_event_type$fatalities_mean <- fatalitymeanByEventType$FATALITIES
stormdata_by_event_type$fatalities_sum  <- fatalitiesByEventType$FATALITIES
stormdata_by_event_type$injuries_mean <- injuriesmeanByEventType$INJURIES
stormdata_by_event_type$injuries_sum  <- injuriesByEventType$INJURIES
```

## Results

Order the stormdata_by_event_type by fatalities and plot fatalities and injuries.
Print out head of both orderings.

Plot fatalities and injuries in fatalities order. <-- This shows the most dangerous.



```{r}
stormdata$dmg <- eval_exp_v(stormdata$PROPDMG, stormdata$PROPDMGEXP)
```


